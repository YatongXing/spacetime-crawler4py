<!-- URL: https://grape.ics.uci.edu/wiki/public/wiki/cs221-2019-spring-project3 -->

<!DOCTYPE html>
<html lang="en-US">   <head>
    <!-- # block head (placeholder in theme.html) -->
        <!-- # block head (content inherited from layout.html) -->
    <title>
      cs221-2019-spring-project3     – Public

    </title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script>
        if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
        </script><![endif]-->

    <link rel="start"  href="/wiki/public/wiki" />
    <link rel="search"  href="/wiki/public/search" />
    <link rel="help"  href="/wiki/public/wiki/TracGuide" />
    <link rel="stylesheet"  href="/wiki/public/chrome/common/css/trac.css" type="text/css" />
    <link rel="stylesheet"  href="/wiki/public/chrome/common/css/wiki.css" type="text/css" />
    <link rel="icon"  href="/wiki/public/chrome/site/favicon.ico" type="image/x-icon" />
    <link rel="alternate"  href="/wiki/public/wiki/cs221-2019-spring-project3?format=txt" title="Plain Text" type="text/x-trac-wiki" />
    <noscript>
      <style>
        .trac-noscript { display: none !important }
      </style>     </noscript>
    <script src="/wiki/public/chrome/common/js/jquery.js"></script>
    <script src="/wiki/public/chrome/common/js/babel.js"></script>
    <script src="/wiki/public/chrome/common/js/trac.js"></script>
    <script src="/wiki/public/chrome/common/js/search.js"></script>
    <script src="/wiki/public/chrome/common/js/folding.js"></script>
    <script src="/wiki/public/chrome/common/js/wiki.js"></script>
    <script>
      jQuery(function($) {
        $(".trac-autofocus").focus();
        $(".trac-target-new").attr("target", "_blank");
        if ($.ui) { /* is jquery-ui added? */
          $(".trac-datepicker:not([readonly])")
            .prop("autocomplete", "off").datepicker();
          // Input current date when today is pressed.
          var _goToToday = $.datepicker._gotoToday;
          $.datepicker._gotoToday = function(id) {
            _goToToday.call(this, id);
            this._selectDate(id)
          };
          $(".trac-datetimepicker:not([readonly])")
            .prop("autocomplete", "off").datetimepicker();
          $("#main").addClass("trac-nodatetimehint");
        }
        $(".trac-disable").disableSubmit(".trac-disable-determinant");
        setTimeout(function() { $(".trac-scroll").scrollToTop() }, 1);
        $(".trac-disable-on-submit").disableOnSubmit();
      });
    </script>
    <!--   # include 'site_head.html' (layout.html) -->
    <!--   end of site_head.html -->
    <!-- # endblock head (content inherited from layout.html) -->


    <script>
      jQuery(function($) {
        wikiColumn($("#wikipage"));
      });
    </script>
    <!-- # endblock head (placeholder in theme.html) -->
  </head> 
  <body>
    <!-- # block body (content inherited from theme.html) -->
    <!--   # include 'site_header.html' (theme.html) -->
    <!--   end of site_header.html -->

    <div id="banner">
      <div id="header">
        <a id="logo"
           href="http://www.ics.uci.edu/">
          <img  alt="ICS Logo" height="67" src="/wiki/public/chrome/site/ics.jpg" width="128" /></a>


      </div>
      <form id="search" action="/wiki/public/search" method="get">
      </form>
          <div id="metanav" class="nav">
      <ul><li  class="first"><a href="/wiki/public/login">Login</a></li><li ><a href="/wiki/public/prefs">Preferences</a></li><li ><a href="/wiki/public/about">About Trac</a></li><li  class="last"><a href="/wiki/public/register">Register</a></li></ul>
    </div>

    </div>
        <div id="mainnav" class="nav">
    </div>


    <div id="main"
         >

<div id="pagepath" class="noprint">
<a class="pathentry first" title="View WikiStart"
   href="/wiki/public/wiki">wiki:</a><a href="/wiki/public/wiki/cs221-2019-spring-project3"
     title="View cs221-2019-spring-project3"
     class="pathentry">cs221-2019-spring-project3</a></div>      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
        <ul>
          <li  class="first last"><a href="/wiki/public/wiki/cs221-2019-spring-project3?action=history">History</a></li>
        </ul>
        <hr />
      </div>

      

      

      <!-- # block content (placeholder in theme.html) -->
    <div id="content" class="wiki narrow">

      <div class="wikipage searchable">
        <div id="wikipage" class="trac-content borderless"><h1 class="section" id="CS221:Project3-PI:Positionalindexphrasesearchcompression">CS221: Project 3 - PI: Positional index, phrase search, compression</h1>
<p>
<strong>Test Cases Due:     Week 6 Fri. (May 10), Due on Github as Pull Requests</strong><br />
<strong>Review Due:           Week 7 Mon. (May 13),  Due on Github as Pull Requests Comments</strong><br />
<strong>Final Code Due:     Week 8, Wed. (May 22),  Due on Github.</strong><br />
</p>
<h2 class="section" id="CodingTasks">Coding Tasks</h2>
<ol><li>Implement LSM-like Positional Index (insertion and merge). (6 points)
</li><li>Implement Phrase Search. (3 points)
</li><li>Implement Compression. (6 points)
</li></ol><h2 class="section" id="TestingTasks">Testing Tasks</h2>
<ol><li>Write at least 2 test cases for a task (2 points)
</li><li>Review the test cases of two teams (2 points)
</li></ol><p>
Total: 19 points 
</p>
<h2 class="section" id="Overview">Overview</h2>
<p>
In this project, you'll be implementing a disk-based positional index and phrase search operations. Compared to the inverted index in Project 2, a positional index stores the positions of all the occurrences of a keyword in a document.  In addition, you'll compress both the inverted index and the positional index.
</p>
<p>
The positional index supports phrase search, which means searching a sequence of keywords in the exact order. For example, the query "new york" will only match documents with "new" immediately followed by "york". A document like "new ... other tokens ... york" won't match.
</p>
<p>
The "position" of a word in the positional index can have different meanings. It could be either a character position or a token position. Token positions can include or exclude stop words. Different kinds of "position" definitions also have different implications on phrase search. For example, for the document "University of California, Irvine", if we search the phrase "University California", the handling of the stop word "of" can affect the search result.
</p>
<p>
In this project, we store <strong>token</strong> positions in the positional index. In particular, we use tokens generated from the analyzer.  If the analyzer removes stop words, then stop words are also excluded from the positional index. For example, the token positions of "cat and dog" are "{cat: 0}, {dog: 1}".
</p>
<h2 class="section" id="Task1:ImplementanLSM-basedpositionalindex.">Task 1: Implement an LSM-based positional index.</h2>
<p>
The on-disk index structure of the positional index is similar to the LSM structure in Project 2. The behavior for <code>addDocument()</code>, <code>flush()</code>, and <code>merge()</code> operations should be the same as Project 2. You should continue using the <code>InvertedIndexManager</code> class from Project 2. 
</p>
<p>
The index format of the positional index should be on top of the inverted index format in Project 2. Recall in Project 2, we have 3 files per segment: docStore, dictionary, and invertedLists. The dictionary stores the pointer from a token to the inverted list of the token. In this project, we need another "positional" file to store the list of positions of a token in a document. The invertedLists needs to store an additional pointer to its position list per documentID.
</p>
<p>
You need to implement the following functions newly added to <code>InvertedIndexManager</code>
</p>
<pre class="wiki">
/**
 * Creates a positional index with a given folder, analyzer, and compressor.
 * Compressor must be used to compress the inverted lists and position lists.
 *
 */
public static InvertedIndexManager createOrOpenPositional(String indexFolder, Analyzer analyzer, Compressor compressor);

/**
 * Reads a disk segment of a positional index into memory based on segmentNum.
 * This function is mainly used for checking correctness in test cases.
 *
 * Throws UnsupportedOperationException if the inverted index is not a positional index.
 *
 * @param segmentNum n-th segment in the inverted index (start from 0).
 * @return in-memory data structure with all contents in the index segment, null if segmentNum don't exist.
 */
public PositionalIndexSegmentForTest getIndexSegmentPositional(int segmentNum);


/**
 * An in-memory representation of a positional index segment, used *only* for testing purposes.
 * Only for this testing class, you could load everything into memory.
 */
public class PositionalIndexSegmentForTest {

    private final Map&lt;String, List&lt;Integer&gt;&gt; invertedLists;
    private final Map&lt;Integer, Document&gt; documents;
    private final Table&lt;String, Integer, List&lt;Integer&gt;&gt; positions;

}

</pre><p>
The positional index should support ALL operations from the inverted index in Project 2 (<code>searchQuery(), searchAndQuery(), searchOrQuery(), documentIterator(), getIndexSegment()</code>). When doing these operations, you could ignore the positional part of the index. We would run all project 2 test cases with your positional index and they should still pass.
</p>
<p>
When designing and implementing this task, you may find limitations of your Project 2 implementation. It is recommended to take this chance to fix those problems to make the development of Project 3 easier.
</p>
<h2 class="section" id="Task2:Implementphrasesearch.">Task 2: Implement phrase search.</h2>
<p>
In this task, you'll implement phrase search using the positional index. You should make same assumptions about IO and tokenization as in project 2.
</p>
<p>
The keywords in the list variable <code>phrase</code> represents a consecutive sequence of keywords.  A document is a result only if it matches the sequence in its exact order.
</p>
<p>
Implement the following function:
</p>
<pre class="wiki">/**
 * Performs a phrase search on a positional index.
 * Phrase search means the document must contain the consecutive sequence of keywords in the exact order.
 *
 * You could assume that the analyzer won't convert each keyword into multiple tokens.
 * Throws UnsupportedOperationException if the inverted index is not a positional index.
 *
 * @param phrase, a consecutive sequence of keywords
 * @return a iterator of documents matching the query
 */
public Iterator&lt;Document&gt; searchPhraseQuery(List&lt;String&gt; phrase);

</pre><h2 class="section" id="Task3:Implementcompression.">Task 3: Implement compression.</h2>
<p>
In this task, you'll implement a compressor based on delta encoding and variable-length encoding. Implement the <code>encode</code> and <code>decode</code> functions for <code>DeltaVarLenCompressor</code>.
</p>
<p>
Delta encoding means storing the difference (delta) between adjacent integers rather than the actual numbers. For example, given a list <code>[3, 5, 8, 13, 20]</code>, the delta encoding stores <code>[3, 2, 3, 5, 7]</code>. 
</p>
<p>
Variable-length encoding of an integer works similarly to UTF-8. We use a variable number of bytes instead of a constant number (4) of bytes to represent an integer. Specifically, in each byte, the first bit indicates if there are more bytes to read - <code>1</code> means reading the next byte and <code>0</code> means termination, and the rest 7 bits are used to encode the integer value. 
</p>
<p>
For example, the integer value <code>13</code> is encoded as <code>00001101</code>. The first bit <code>0</code> means no more bytes to read, and the rest 7 bits <code>0001101</code> represent the number 13. The integer value <code>128</code> (<code>2^7</code>) is encoded as <code>10000001 00000000</code>. The first bit in the first byte indicates the inclusion of the next byte. The integer value <code>16,384</code> (<code>2^14</code>) is encoded as <code>10000001 10000000 00000000</code>.
</p>
<pre class="wiki">/**
 * Encodes a list of integers to a byte array.
 */
byte[] encode(List&lt;Integer&gt; integers);

/**
 * Decodes part of a byte array to a list of integers.
 *
 * @param bytes bytes to decode
 * @param startOffset starting position to decode
 * @param length number of bytes to decode from start position
 */
List&lt;Integer&gt; decode(byte[] bytes, int startOffset, int length);
</pre><p>
The compressor should be used to compress the inverted lists and the positional lists. The compressor interface has a reference implementation <code>NaiveCompressor</code>, which does normal integer encoding without any compression. In test cases, two positional indexes will be constructed with <code>NaiveCompressor</code> and <code>DeltaVarLenCompressor</code> and the read/write counters will be compared to determine the compression ratio.
</p>
<h2 class="section" id="Testcases">Test cases</h2>
<p>
Please follow the similar general guideline and procedure as in Project 1 and 2. Here are the <a class="ext-link" href="https://docs.google.com/spreadsheets/d/1_iwJOT-bnYDk9tWNNy61GCyi1kRN7s3VHdn5h_2T1DA/edit#gid=303113227"><span class="icon">​</span>test case assignments</a>.
</p>
<p>
Guidelines for p3:
</p>
<ul><li>Put all test cases in the package <code>edu.uci.ics.cs221.index.positional</code> with the naming convention in the spreadsheet.
</li><li>The grade will be also based the quality of the test cases.
</li></ul><p>
Detail description of test cases:
</p>
<ul><li>Task1: Flush Positional Segments / Task1: Merge Positional Segments. Test the correctness of positional index flushing and merging operations using <code>getNumSegments</code> and <code>getIndexSegmentPositional</code>. Verify the content of the positional index is correct.
</li><li>Task2: Phrase Search. Construct various phrase search queries and check the result the query is correct.
</li><li>Task3: Compressor Correctness. Test the correctness of <code>encode</code> and <code>decode</code> functions of the <code>DeltaVarLenCompressor</code>. Verify the result byte array matches delta encoding and variable length encoding. Don't test the compressor with invalid inputs.
</li><li>Task3: Compare Index with Compression. Test the effect of the compressor to the positional index. Build the positional index using the no compression <code>NaiveCompressor</code> using non-trivial amount of data and record the IO counter values. Then Build the positional index using same data with <code>DeltaVarLenCompressor</code>. Compare the IO counter values to verify the compression ratio.
</li><li>Overall: Large Data Stress Test. Test the positional index with a large amount of data. Using same dataset with project 2 stress test is prohibited.
</li></ul></div>
        <div class="trac-modifiedby">
          <span>
            <a href="/wiki/public/wiki/cs221-2019-spring-project3?action=diff&amp;version=20" title="Version 20 by Zuozhi Wang">Last modified</a>
 <a class="timeline" href="/wiki/public/timeline?from=2019-05-13T16%3A42%3A23-07%3A00&amp;precision=second" title="See timeline at May 13, 2019, 4:42:23 PM">6 years ago</a>          </span>
          <span class="trac-print">
            Last modified on May 13, 2019, 4:42:23 PM
          </span>
        </div>
      </div>





<div id="attachments">
  <h3  class="foldable">
    Attachments
    <span class="trac-count">(3)</span></h3>
  <div>
    <ul>
      <li>
        <a href="/wiki/public/attachment/wiki/cs221-2019-spring-project3/Team10PositionalStressTest.txt" title="View attachment">Team10PositionalStressTest.txt</a><a href="/wiki/public/raw-attachment/wiki/cs221-2019-spring-project3/Team10PositionalStressTest.txt"
          class="trac-rawlink" title="Download">&#8203;</a>
 (<span title="1034736 bytes">1010.5 KB</span>
) - added by <span class="trac-author">Zuozhi Wang</span> <a class="timeline" href="/wiki/public/timeline?from=2019-05-16T15%3A02%3A38-07%3A00&amp;precision=second" title="See timeline at May 16, 2019, 3:02:38 PM">6 years ago</a>.
      </li>
      <li>
        <a href="/wiki/public/attachment/wiki/cs221-2019-spring-project3/Team9PositionalStressTest.txt" title="View attachment">Team9PositionalStressTest.txt</a><a href="/wiki/public/raw-attachment/wiki/cs221-2019-spring-project3/Team9PositionalStressTest.txt"
          class="trac-rawlink" title="Download">&#8203;</a>
 (<span title="7536 bytes">7.4 KB</span>
) - added by <span class="trac-author">Zuozhi Wang</span> <a class="timeline" href="/wiki/public/timeline?from=2019-05-16T17%3A48%3A08-07%3A00&amp;precision=second" title="See timeline at May 16, 2019, 5:48:08 PM">6 years ago</a>.
      </li>
      <li>
        <a href="/wiki/public/attachment/wiki/cs221-2019-spring-project3/Team8StressTest.txt" title="View attachment">Team8StressTest.txt</a><a href="/wiki/public/raw-attachment/wiki/cs221-2019-spring-project3/Team8StressTest.txt"
          class="trac-rawlink" title="Download">&#8203;</a>
 (<span title="7949 bytes">7.8 KB</span>
) - added by <span class="trac-author">Zuozhi Wang</span> <a class="timeline" href="/wiki/public/timeline?from=2019-06-10T13%3A18%3A40-07%3A00&amp;precision=second" title="See timeline at Jun 10, 2019, 1:18:40 PM">6 years ago</a>.
      </li>
    </ul>
    <p>
  Download all attachments as:
  <a rel="nofollow" href="/wiki/public/zip-attachment/wiki/cs221-2019-spring-project3/">.zip</a>
</p>

  </div>
</div>
<div class="trac-help">
  <strong>Note:</strong>
 See   <a href="/wiki/public/wiki/TracWiki">TracWiki</a>
 for help on using the wiki.
</div>
    </div>
        <!-- # block content (content inherited from layout.html) -->
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first last">
          <a rel="nofollow" href="/wiki/public/wiki/cs221-2019-spring-project3?format=txt"
              class="">
            Plain Text</a>
        </li>
      </ul>
    </div>
    <!-- # endblock content (content inherited from layout.html) -->

      <!-- # endblock content (placeholder in theme.html) -->
    </div>

    <div id="footer"><hr/>
      <a id="tracpowered" href="https://trac.edgewall.org/"
         ><img src="/wiki/public/chrome/common/trac_logo_mini.png" height="30"
               width="107" alt="Trac Powered"/></a>
      <p class="left">
Powered by         <a href="/wiki/public/about"><strong>Trac 1.5.3</strong></a>
        <br />
 By         <a href="http://www.edgewall.org/">Edgewall Software</a>
.      </p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
    <!--   # include 'site_footer.html' (theme.html) -->
    <!--   end of site_footer.html -->
    <!-- # endblock body (content inherited from theme.html) -->
  </body> </html>